# Technical Glossary - 技術用語集

ISUCONおよびWebパフォーマンスチューニングでよく使われる技術用語を解説します。

---

## アーキテクチャ関連

### リバースプロキシ (Reverse Proxy)

クライアントとバックエンドサーバーの間に位置し、クライアントからのリクエストを適切なバックエンドに転送するサーバー。本プロジェクトではNginxがリバースプロキシとして動作しています。

**メリット**:
- 静的ファイルの配信をバックエンドから分離
- SSL/TLS終端
- ロードバランシング
- レスポンスキャッシュ

```
Client → [Nginx (リバースプロキシ)] → [PHP-FPM (アプリケーション)]
```

### FastCGI

WebサーバーとアプリケーションプロセスがHTTPとは別のバイナリプロトコルで通信する仕組み。CGIと異なり、プロセスが常駐するため起動コストがかかりません。

```nginx
fastcgi_pass app:9000;  # TCP接続でFastCGIプロトコルを使用
```

### PHP-FPM (FastCGI Process Manager)

PHPのFastCGI実装。ワーカープロセスのプール管理、動的なプロセス数調整、スローログ出力などの機能を持ちます。

- **static**: ワーカー数を固定
- **dynamic**: 負荷に応じてワーカー数を自動調整
- **ondemand**: リクエストがあった時のみワーカーを起動

### Docker Compose

複数のDockerコンテナを定義・管理するためのツール。`compose.yml`ファイルでサービス群を宣言的に定義します。

```yaml
services:
  app:       # PHP-FPM コンテナ
  nginx:     # Nginx コンテナ
  mysql:     # MySQL コンテナ
  memcached: # Memcached コンテナ
```

---

## データベース関連

### N+1クエリ問題

1回のメインクエリ（1）の結果に対して、各行ごとに追加クエリ（N）を実行してしまうパフォーマンスアンチパターン。データ量に比例してクエリ数が増加します。

```
1回: SELECT * FROM posts                    ← メインクエリ
N回: SELECT * FROM users WHERE id = ?       ← 結果の各行に対して
```

**解決策**:
- IN句でのバッチ取得
- JOINを使った結合クエリ
- Eager Loading（ORMの場合）

→ 詳細は [PR #5](./PR5-N-Plus-1-Query-Fix.md) を参照

### インデックス (Index)

データベーステーブルの特定カラムに対して作成される検索用のデータ構造。B+Tree構造が一般的で、検索・ソート・結合を高速化します。

```sql
CREATE INDEX idx_comments_post_id ON comments(post_id);
```

**インデックスなし（フルテーブルスキャン）**:
```
100,000行を全てスキャン → O(n)
```

**インデックスあり（B+Treeルックアップ）**:
```
ツリーを辿って目的の行を特定 → O(log n)
```

**注意点**:
- INSERT/UPDATE時にインデックスの更新コストが発生
- 書き込みが多いテーブルではインデックスの追加は慎重に
- カーディナリティ（値の種類数）が低いカラムではインデックスの効果が薄い

### B+Tree

データベースインデックスで最も一般的に使われるツリー構造。

```
        [50]                    ← ルートノード
       /    \
    [20,30]  [70,80]           ← 内部ノード
    / | \    / | \
  [10][25][35][60][75][90]     ← リーフノード（実データへのポインタ）
```

- リーフノードが連結リストで接続されているため、範囲検索が高速
- 全てのリーフが同じ深さにあるため、検索時間が安定

### ウィンドウ関数 (Window Function)

結果セットの「ウィンドウ」（部分集合）に対して計算を行うSQL関数。GROUP BYと異なり、元の行を維持したまま集計値を追加できます。

```sql
ROW_NUMBER() OVER (
    PARTITION BY post_id        -- post_idごとにグループ化
    ORDER BY created_at DESC    -- 各グループ内でソート
)
```

**主なウィンドウ関数**:
- `ROW_NUMBER()`: 連番を振る
- `RANK()`: 同順位ありの順位付け
- `SUM() OVER (...)`: 累積合計
- `LAG()` / `LEAD()`: 前後の行の値を参照

### BLOB (Binary Large Object)

データベースにバイナリデータ（画像、動画、ファイル等）を格納するためのデータ型。MySQLでは`TINYBLOB`, `BLOB`, `MEDIUMBLOB`, `LONGBLOB`のサイズバリエーションがあります。

**一般的なベストプラクティス**: BLOBではなくファイルシステムやオブジェクトストレージ（S3等）に保存し、DBにはパスのみ格納する。

### プリペアドステートメント (Prepared Statement)

SQLクエリのテンプレートを事前にコンパイルし、パラメータを後からバインドする仕組み。SQLインジェクション対策として必須です。

```php
$ps = $db->prepare('SELECT * FROM users WHERE id = ?');
$ps->execute([$id]);  // パラメータをバインドして実行
```

---

## パフォーマンス関連

### ベンチマーカー

Webアプリケーションに対してHTTPリクエストを大量に送信し、レスポンス時間・スループット・正確性を測定するツール。ISUCONではベンチマーカーがスコアを算出します。

### スループット (Throughput)

単位時間あたりに処理できるリクエスト数。一般に「リクエスト/秒」（RPS）で表されます。

### レイテンシ (Latency)

リクエストを送信してからレスポンスが返るまでの時間。通常ミリ秒（ms）単位で測定されます。

### タイムアウト

リクエストの応答が一定時間内に返らなかった場合に、接続を切断すること。ISUCONではタイムアウトしたリクエストはfail（失敗）としてカウントされます。

### ボトルネック

システム全体のパフォーマンスを制限している最も遅い部分。ボトルネックを特定し解消することがパフォーマンスチューニングの核心です。

### フルテーブルスキャン

インデックスを使用せずにテーブルの全行を読み込んで条件に合致する行を探す操作。データ量に比例して遅くなります。

### プロセスフォーク (fork)

実行中のプロセスのコピーを作成するシステムコール。子プロセスは親プロセスのメモリ空間をコピーして開始します。シェルコマンドの実行には必ずforkが必要であり、コストが高い操作です。

---

## Web関連

### try_files (Nginx)

Nginxのディレクティブで、指定した順序でファイルの存在を確認し、最初に見つかったファイルを返します。

```nginx
try_files $uri @app;
# 1. $uri（リクエストされたパスのファイル）を探す
# 2. なければ @app（名前付きロケーション）にフォールバック
```

### Cache-Control

HTTPレスポンスヘッダで、ブラウザやプロキシがレスポンスをキャッシュする方法を制御します。

```
Cache-Control: public, immutable
```

- `public`: プロキシキャッシュも許可
- `immutable`: コンテンツが変更されないことを宣言（再検証リクエストを抑制）

### セッション

ステートレスなHTTPプロトコル上でユーザーの状態を維持する仕組み。本プロジェクトではMemcachedにセッションデータを格納しています。

---

## セキュリティ関連

### SQLインジェクション

ユーザー入力をSQLクエリに直接埋め込むことで、意図しないSQLを実行させる攻撃。プリペアドステートメントの使用で防止できます。

```php
// 危険: SQLインジェクションの脆弱性あり
$db->query("SELECT * FROM users WHERE id = $id");

// 安全: プリペアドステートメント使用
$ps = $db->prepare('SELECT * FROM users WHERE id = ?');
$ps->execute([$id]);
```

### コマンドインジェクション

ユーザー入力をシェルコマンドに埋め込むことで、意図しないコマンドを実行させる攻撃。

```php
// 潜在的リスク: escapeshellarg()で軽減しているが、シェル実行自体がリスク
$src = escapeshellarg($src);
return trim(`printf "%s" {$src} | openssl dgst -sha512 | sed 's/^.*= //'`);

// 根本的対策: シェルコマンドを使わない
return hash('sha512', $src);
```

### パストラバーサル

ファイルパスにユーザー入力を使用することで、意図しないディレクトリのファイルにアクセスさせる攻撃。

```php
// 対策: ユーザー入力をファイル名に使用しない
$image_path = IMAGE_DIR . "/{$post_id}.{$ext}";  // post_idはDB生成のID
```

### CSRF (Cross-Site Request Forgery)

ユーザーが認証済みのWebアプリケーションに、意図しないリクエストを送信させる攻撃。本アプリケーションではCSRFトークンで防止しています。

```php
$_SESSION['csrf_token'] = bin2hex(random_bytes(16));
// フォーム送信時にトークンを検証
if ($params['csrf_token'] !== $_SESSION['csrf_token']) {
    return $response->withStatus(422);
}
```
